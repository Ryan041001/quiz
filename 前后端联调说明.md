# Quiz后台管理系统 - 前后端联调说明

## 项目概述

本项目实现了Quiz后台管理系统的前后端完整功能，包括：
- ✅ 用户登录认证（JWT令牌）
- ✅ 题目分页查询、关键词搜索、添加、删除
- ✅ 用户分页查询、关键词搜索、添加、删除
- ✅ 导航守卫（前端路由拦截）
- ✅ 退出登录功能
- ✅ 跨域访问配置

## 技术栈

### 后端
- Spring Boot 3.5.7
- MyBatis
- MySQL
- JWT (JSON Web Token)
- Lombok

### 前端
- Vue 2
- Element UI
- Axios
- Vue Router

## 启动步骤

### 1. 后端启动

#### 1.1 确保MySQL数据库运行
```bash
# 确保MySQL服务已启动
# 默认端口：3306
```

#### 1.2 配置数据库连接
检查 `src/main/resources/application.properties` 文件：
```properties
spring.datasource.url=jdbc:mysql://localhost:3306/quiz?useSSL=false&serverTimezone=Asia/Shanghai
spring.datasource.username=root
spring.datasource.password=your_password
```

#### 1.3 启动Spring Boot应用
```bash
# 在项目根目录下执行
mvn spring-boot:run

# 或者在IDE中运行 QuizApplication.java
```

后端将在 `http://localhost:8080` 启动

### 2. 前端启动

#### 2.1 安装依赖
```bash
cd ../quiz-backstage-management
npm install
```

#### 2.2 启动开发服务器
```bash
npm run serve
```

前端将在 `http://localhost:8081` 启动

## 测试账号

系统已预置测试账号（密码已MD5加密）：

| 用户名 | 密码 | 说明 |
|--------|------|------|
| admin | 123456 | 管理员账号 |
| 王小虎 | 123456 | 测试用户 |
| 李明 | 123456 | 测试用户 |
| 张三 | 123456 | 测试用户 |

## 功能测试指南

### 1. 登录功能测试
1. 访问 `http://localhost:8081`
2. 自动跳转到登录页面
3. 输入用户名：`admin`，密码：`123456`
4. 点击登录按钮
5. 登录成功后自动跳转到用户管理页面

### 2. 用户管理功能测试

#### 2.1 用户列表分页查询
- 默认每页显示5条记录
- 可以点击页码切换页面

#### 2.2 用户关键词搜索
- 在搜索框输入用户名关键词（如"王"）
- 点击"查询"按钮
- 系统显示匹配的用户列表

#### 2.3 添加用户
- 点击"添加用户"按钮
- 填写用户名和密码
- 点击"确定"
- 系统提示添加成功，列表自动刷新

#### 2.4 删除用户
- 点击用户列表中的"删除"按钮
- 确认删除操作
- 系统提示删除成功，列表自动刷新

### 3. 题目管理功能测试

#### 3.1 切换到题目管理
- 点击左侧菜单的"题目管理"

#### 3.2 题目列表分页查询
- 默认每页显示5条记录
- 可以点击页码切换页面

#### 3.3 题目关键词搜索
- 在搜索框输入题目关键词
- 点击"查询"按钮
- 系统显示匹配的题目列表

#### 3.4 添加题目
- 点击"添加题目"按钮
- 填写题目内容、四个选项和答案
- 点击"确定"
- 系统提示添加成功，列表自动刷新

#### 3.5 删除题目
- 点击题目列表中的"删除"按钮
- 确认删除操作
- 系统提示删除成功，列表自动刷新

### 4. 退出登录功能测试
- 点击页面右上角的"退出登录"按钮
- 确认退出
- 系统清除本地token
- 自动跳转到登录页面

### 5. 导航守卫测试
- 退出登录后，尝试直接访问 `http://localhost:8081/user` 或 `http://localhost:8081/question`
- 系统自动拦截并跳转到登录页面
- 登录后才能访问这些受保护的页面

## 核心技术实现

### 1. JWT令牌认证流程
```
1. 用户登录 → 后端验证用户名密码
2. 验证成功 → 生成JWT令牌返回给前端
3. 前端保存token到localStorage
4. 后续请求 → 请求头自动携带token
5. 后端Filter拦截 → 验证token有效性
6. token有效 → 放行请求
7. token无效 → 返回401状态码
8. 前端拦截401 → 跳转到登录页
```

### 2. 前端响应拦截器
```javascript
// 请求拦截器：自动添加token
axios.interceptors.request.use(config => {
  const token = localStorage.getItem("token");
  if (token) {
    config.headers.token = token;
  }
  return config;
});

// 响应拦截器：处理业务错误和认证失败
axios.interceptors.response.use(
  response => {
    if (response.data.code === 1) {
      return response.data;
    } else {
      ElementUI.Message.error(response.data.message);
      return Promise.reject(new Error(response.data.message));
    }
  },
  error => {
    if (error.response.status === 401) {
      localStorage.removeItem("token");
      router.push("/login");
    }
    return Promise.reject(error);
  }
);
```

### 3. 后端JWT过滤器
```java
@WebFilter(urlPatterns = "/*")
public class JwtFilter implements Filter {
    public void doFilter(ServletRequest req, ServletResponse res, FilterChain chain) {
        // 1. 登录接口放行
        if (url.contains("login")) {
            chain.doFilter(request, response);
            return;
        }
        
        // 2. 验证token
        String token = request.getHeader("token");
        if (!StringUtils.hasLength(token)) {
            // 返回401未授权
            response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);
            return;
        }
        
        // 3. 解析token
        try {
            JwtUtil.parseToken(token);
            chain.doFilter(req, res); // 验证通过，放行
        } catch (Exception e) {
            // token无效，返回401
            response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);
        }
    }
}
```

### 4. 跨域配置
```java
@Configuration
public class CorsConfig implements WebMvcConfigurer {
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")
                .allowedOrigins("http://localhost:8081")
                .allowedMethods("GET", "POST", "PUT", "DELETE", "OPTIONS")
                .allowedHeaders("*")
                .allowCredentials(true);
    }
}
```

### 5. 前端路由守卫
```javascript
router.beforeEach((to, from, next) => {
  const token = localStorage.getItem("token");
  
  if (to.matched.some(record => record.meta.requiresAuth)) {
    if (!token) {
      // 未登录，跳转到登录页
      next({
        path: "/login",
        query: { redirect: to.fullPath }
      });
    } else {
      next(); // 已登录，放行
    }
  } else {
    next();
  }
});
```

## 常见问题

### 1. 前端无法连接后端
**问题**：前端请求后端接口时出现跨域错误或连接失败

**解决方案**：
- 确保后端已启动在 `http://localhost:8080`
- 确保前端已配置代理（vue.config.js）
- 确保后端已配置CORS（CorsConfig.java）

### 2. 登录后立即提示未登录
**问题**：登录成功但访问其他页面提示401

**解决方案**：
- 检查JWT token是否正确保存到localStorage
- 检查请求拦截器是否正确添加token到请求头
- 检查后端JwtFilter是否正确启用（需要@ServletComponentScan）

### 3. 数据库连接失败
**问题**：启动后端时提示数据库连接错误

**解决方案**：
- 确保MySQL服务已启动
- 检查application.properties中的数据库配置
- 确保数据库quiz已创建
- 检查用户名密码是否正确

### 4. 密码加密不匹配
**问题**：使用测试账号无法登录

**解决方案**：
- 确保schema.sql中的密码已使用MD5加密
- 加密格式：MD5(SALT + password)，其中SALT="com.quiz"
- 测试密码123456的MD5值应为：e4b5f91c137d75d333d99a7a9fdc3b41

## 项目亮点

1. ✨ **完整的JWT认证体系**：从登录到令牌验证的完整流程
2. ✨ **前端路由守卫**：保护需要认证的页面
3. ✨ **统一的响应拦截**：自动处理认证失败和业务错误
4. ✨ **分页查询优化**：支持关键词搜索的分页功能
5. ✨ **跨域完美解决**：开发环境和生产环境的跨域配置
6. ✨ **密码安全存储**：使用MD5+盐值加密用户密码
7. ✨ **用户友好提示**：所有操作都有明确的成功/失败提示

## 开发者信息

- 后端端口：8080
- 前端端口：8081
- 数据库：MySQL
- JWT过期时间：1小时

## 扩展功能建议

1. 添加题目编辑功能
2. 添加用户编辑功能
3. 添加用户角色权限管理
4. 添加操作日志记录
5. 添加数据导出功能
6. 优化分页组件（支持每页显示条数选择）
7. 添加题目批量导入功能
